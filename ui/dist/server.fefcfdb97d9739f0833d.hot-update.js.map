{"version":3,"sources":["webpack:///./src/SignInNavItem.jsx"],"names":["SigninNavItem","React","Component","constructor","props","state","showing","disabled","user","signedIn","givenName","showModal","bind","hideModal","signOut","signIn","componentDidMount","clientId","window","ENV","GOOGLE_CLIENT_ID","gapi","load","auth2","getAuthInstance","init","client_id","then","setState","loadData","apiEndpoint","UI_AUTH_ENDPOINT","response","fetch","method","body","text","result","JSON","parse","showError","googleToken","googleUser","getAuthResponse","id_token","error","headers","stringify","google_token","render","withToast"],"mappings":"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","file":"server.fefcfdb97d9739f0833d.hot-update.js","sourcesContent":["import React from 'react';\nimport {\n    NavItem, Modal, Button, NavDropdown, MenuItem,\n} from 'react-bootstrap';\n\nimport withToast from './withToast.jsx';\n\nclass SigninNavItem extends React.Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            showing: false,\n            disabled: true,\n            user: { signedIn: false, givenName: '' },\n        };\n        this.showModal = this.showModal.bind(this);\n        this.hideModal = this.hideModal.bind(this);\n        this.signOut = this.signOut.bind(this);\n        this.signIn = this.signIn.bind(this);\n    }\n\n    async componentDidMount() {\n        const clientId = window.ENV.GOOGLE_CLIENT_ID;\n        if (!clientId) return;\n        window.gapi.load('auth2', () => {\n            if (!window.gapi.auth2.getAuthInstance()) {\n                window.gapi.auth2.init({ client_id: clientId }).then(() => {\n                    this.setState({ disabled: false });\n                });\n            }\n        });\n        await this.loadData();\n    }\n\n    async loadData() {\n        const apiEndpoint = window.ENV.UI_AUTH_ENDPOINT;\n        const response = await fetch(`${apiEndpoint}/user`, {\n            method: 'POST',\n        });\n        const body = await response.text();\n        const result = JSON.parse(body);\n        const { signedIn, givenName } = result;\n        this.setState({ user: { signedIn, givenName } });\n    }\n\n    async signIn() {\n        this.hideModal();\n        const { showError } = this.props;\n        let googleToken;\n        try {\n            const auth2 = window.gapi.auth2.getAuthInstance();\n            const googleUser = await auth2.signIn();\n            googleToken = googleUser.getAuthResponse().id_token;\n        } catch (error) {\n            showError(`Error authenticating with Google: ${error.error}`);\n        }\n\n        try {\n            const apiEndpoint = window.ENV.UI_AUTH_ENDPOINT;\n            const response = await fetch(`${apiEndpoint}/signin`, {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({ google_token: googleToken }),\n            });\n            const body = await response.text();\n            const result = JSON.parse(body);\n            const { signedIn, givenName } = result;\n\n            this.setState({ user: { signedIn, givenName } });\n        } catch (error) {\n            showError(`Error signing into the app: ${error}`);\n        }\n    }\n\n    signOut() {\n        this.setState({ user: { signedIn: false, givenName: '' } });\n    }\n\n    showModal() {\n        const clientId = window.ENV.GOOGLE_CLIENT_ID;\n        const { showError } = this.props;\n        if (!clientId) {\n            showError('Missing environment variable GOOGLE_CLIENT_ID');\n            return;\n        }\n        this.setState({ showing: true });\n    }\n\n    hideModal() {\n        this.setState({ showing: false });\n    }\n\n    render() {\n        const { user } = this.state;\n        if (user.signedIn) {\n            return (\n                <NavDropdown title={user.givenName} id=\"user\">\n                    <MenuItem onClick={this.signOut}>Sign out</MenuItem>\n                </NavDropdown>\n            );\n        }\n\n        const { showing, disabled } = this.state;\n        return (\n            <>\n                <NavItem onClick={this.showModal}>\n                    Sign in\n                </NavItem>\n                <Modal keyboard show={showing} onHide={this.hideModal} bsSize=\"sm\">\n                    <Modal.Header closeButton>\n                        <Modal.Title>Sign in</Modal.Title>\n                    </Modal.Header>\n                    <Modal.Body>\n                        <Button\n                            block\n                            disabled={disabled}\n                            bsStyle=\"primary\"\n                            onClick={this.signIn}\n                        >\n                            <img src=\"https://goo.gl/4yjp6B\" alt=\"Sign In\" />\n                        </Button>\n                    </Modal.Body>\n                    <Modal.Footer>\n                        <Button bsStyle=\"link\" onClick={this.hideModal}>Cancel</Button>\n                    </Modal.Footer>\n                </Modal>\n            </>\n        );\n    }\n}\nexport default withToast(SigninNavItem);"],"sourceRoot":""}